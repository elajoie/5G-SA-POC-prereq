authoritative;
ddns-update-style interim;
default-lease-time 14400;
max-lease-time 14400;
option routers                  {{ dhcp.router }};
option broadcast-address        {{ dhcp.bcast }};
option subnet-mask              {{ dhcp.netmask }};
option domain-name-servers      {{ dhcp.dns }};
option domain-name              "{{ dhcp.domainname }}";
option space pxelinux;
option pxelinux.magic code 208 = string;
option pxelinux.configfile code 209 = text;
option pxelinux.pathprefix code 210 = text;
option pxelinux.reboottime code 211 = unsigned integer 32;
option architecture-type code 93 = unsigned integer 16;

subnet {{  dhcp.ipid }} netmask {{  dhcp.netmaskid }} {
    range {{ dhcp.poolstart }} {{ dhcp.poolend }};

	class "pxeclients" {
  	  match if substring (option vendor-class-identifier, 0, 9) = "PXEClient";
  	  next-server {{ ansible_default_ipv4["address"] }};

  	  if option architecture-type = 00:07 {
  	    filename "uefi/BOOTX64.EFI";
  	  } else {
  	    filename "pxelinux/pxelinux.0";
  		}
    }
}

host {{ nodes.bootstrap.name }} {
	option host-name "{{ nodes.bootstrap.name }}.{{ baseName }}.{{ baseDomain }}";
	hardware ethernet {{ nodes.bootstrap.macaddr }}; 
	fixed-address {{ nodes.bootstrap.ipaddr }};
}

{% for m in nodes.masters %}
host {{ m.name }} {
	option host-name "{{ m.name }}.{{ baseName }}.{{ baseDomain }}";
	hardware ethernet {{ m.macaddr }};
	fixed-address {{ m.ipaddr }};
}
{% endfor %}

{% for w in nodes.workers %}
host {{ w.name }} {
	option host-name "{{ w.name }}.{{ baseName }}.{{ baseDomain }}";
	hardware ethernet {{ w.macaddr }};
	fixed-address {{ w.ipaddr }};
}
{% endfor %}

# this is PXE specific
filename "pxelinux.0";
 


